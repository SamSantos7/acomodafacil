"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},665:e=>{e.exports=require("dns")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},3168:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var o={};t.r(o),t.d(o,{POST:()=>f});var i=t(9303),a=t(8716),s=t(670),n=t(7070),u=t(3524),p=t(5456);let c=new u.PrismaClient;async function d(e){let r=Math.floor(1e4+9e4*Math.random()).toString(),t=new Date(Date.now()+3e5);return await c.oTP.create({data:{email:e,code:r,expiresAt:t}}),r}async function l(e,r){let t=await c.oTP.findFirst({where:{email:e,code:r,expiresAt:{gt:new Date},used:!1}});if(!t)return null;await c.oTP.update({where:{id:t.id},data:{used:!0}});let o=await c.user.findUnique({where:{email:e}});o||(o=await c.user.create({data:{email:e,name:e.split("@")[0],password:"",provider:"email"}}));let i=(0,p.RA)(o.id);return{user:o,token:i}}var x=t(471);async function f(e){try{let{email:r,otp:t}=await e.json();if(!t){let e=await d(r);if(!await (0,x.a)(r,e))return n.NextResponse.json({error:"Erro ao enviar c\xf3digo de verifica\xe7\xe3o"},{status:500});return n.NextResponse.json({message:"C\xf3digo de verifica\xe7\xe3o enviado com sucesso"})}let o=await l(r,t);if(!o)return n.NextResponse.json({error:"C\xf3digo de verifica\xe7\xe3o inv\xe1lido ou expirado"},{status:401});let{user:i,token:a}=o,{password:s,...u}=i;return n.NextResponse.json({user:u,token:a})}catch(e){return console.error("Login error:",e),n.NextResponse.json({error:"Erro ao fazer login"},{status:500})}}new u.PrismaClient;let m=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"c:\\Users\\samue\\Downloads\\acomodafacil-global-homes-740cc4e93a81954d529326e515feba7b3d6541ab\\acomodafacil\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:h}=m,w="/api/auth/login/route";function q(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},5456:(e,r,t)=>{t.d(r,{RA:()=>a,WX:()=>s}),t(8691);var o=t(1482);let i=new(t(3524)).PrismaClient;function a(e){return(0,o.sign)({userId:e},process.env.JWT_SECRET,{expiresIn:"7d"})}async function s(e){try{let r=(0,o.verify)(e,process.env.JWT_SECRET);return await i.user.findUnique({where:{id:r.userId},select:{id:!0,email:!0,name:!0}})}catch(e){return null}}},471:(e,r,t)=>{t.d(r,{a:()=>i});let o=t(5245).createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT),secure:!0,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});async function i(e,r){let t={from:process.env.SMTP_FROM,to:e,subject:"C\xf3digo de Verifica\xe7\xe3o - Acomoda F\xe1cil",html:`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <h2 style="color: #333;">C\xf3digo de Verifica\xe7\xe3o</h2>
        <p>Seu c\xf3digo de verifica\xe7\xe3o \xe9:</p>
        <div style="background-color: #f4f4f4; padding: 10px; text-align: center; font-size: 24px; letter-spacing: 5px; margin: 20px 0;">
          <strong>${r}</strong>
        </div>
        <p>Este c\xf3digo expira em 5 minutos.</p>
        <p>Se voc\xea n\xe3o solicitou este c\xf3digo, por favor ignore este e-mail.</p>
      </div>
    `};try{return await o.sendMail(t),!0}catch(e){return console.error("Error sending email:",e),!1}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,653,482,70,245],()=>t(3168));module.exports=o})();